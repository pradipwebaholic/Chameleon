(function(e){e.fn.colorpicker=function(t){e.fn.colorpicker.defaults={mirror:true,nthLayer:1,auto:false,target:"a"};t=e.extend(e.fn.colorpicker.defaults,t);return this.each(function(){function r(){_color=i(n);if(_color=="transparent"){_color="rgb(0,0,0,0)"}if(t.mirror==true){_color=_color.split("(")[1].split(")")[0].split(",");_color="rgb("+(225-parseInt(_color[0]))+","+(225-parseInt(_color[1]))+","+(225-parseInt(_color[2]))+")"}n.find(t.target).css({color:_color});n.filter(t.target).css({color:_color})}function i(e){target=e;_left=parseInt(target.position().left)+target.outerWidth()/2;_top=parseInt(target.position().top)+target.outerHeight()/2;_new=u(target);if(_new.prop("tagName")=="IMG"){return o(_new,_left,_top)}else{return s(_new,_left,_top)}}function s(t,n,r){bgimage=t.css("background-image");if(bgimage!="none"){bgimage=bgimage.split("/");bgimage=bgimage[bgimage.length-2]+"/"+bgimage[bgimage.length-1].split('"')[0];e("body").append("<img id='bg' style='display:none' src='"+bgimage+"'/>");return o(e("#bg"),n,r)}else{return t.css("background-color")}}function o(t,n,r){e("body").append('<canvas id="myCanvas" width="'+t.outerWidth()+'" height="'+t.outerHeight()+'" style="border:1px solid #d3d3d3; display:none"; ></canvas>');var i;var s=new Image;var o=document.getElementById("myCanvas").getContext("2d");s.src=t.attr("src");o.drawImage(s,0,0,t.width(),t.height());i=o.getImageData(n,r,10,10).data;e("#myCanvas,#bg").remove();return"rgb("+i[0]+","+i[1]+","+i[2]+")"}function u(e){n=e;x=n.offset().left;y=n.offset().top;ele=a(x,y);ele=ele[ele.size()-(t.nthLayer+1)];return ele}function a(t,n){var r=e("body *").map(function(){var r=e(this);var i=r.offset();var s=i.left;var o=i.top;var u=r.height();var a=r.width();var f=s+a;var l=o+u;return n<=l&&n>=o&&t<=f&&t>=s?r:null});return r}var n=e(this);t.auto?setInterval(r,500):r()})}})(jQuery)
